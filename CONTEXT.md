# FortiGate 60F - FIPS-CC + CMMC Level 2 Configuration Context

## Device Information
- **Model:** FortiGate 60F
- **Serial Number:** FGT60FTK24031122
- **Current Version:** FortiOS 7.4.11 build2878 (Mature)
- **Security Level:** High
- **FIPS-CC Mode:** Enabled (IRREVERSIBLE - cannot be disabled without factory reset)
- **Operation Mode:** NAT
- **Hostname:** CBS-FORTI

## Current Network Configuration

### WAN Interface (Production)
- **wan1:** Physical interface, trunk mode for VLAN 847
- **wan1.847:** Production WAN VLAN
  - IP: 204.186.251.250/30
  - Gateway: 204.186.251.249
  - VLAN ID: 847
  - **Status:** UP (1000Mbps full duplex)
  - **MAC Address:** 48:3a:02:57:b5:b8
- **Note:** Fiber ISP connection active and operational

### Internal VLAN Interfaces
All VLANs are on the "internal" hardware switch (physical ports internal1-5):
**Note:** Interface names are `internal.X` (not `internal1.X`)

1. **internal.3** - IoT Guest Network
   - IP: 172.16.3.1/24
   - VLAN ID: 3
   - DHCP Pool: 172.16.3.100-200
   - DNS: 1.1.1.1, 8.8.8.8

2. **internal.4** - CORP-LAN (Corporate Network)
   - IP: 172.16.4.1/24
   - VLAN ID: 4
   - DHCP Pool: 172.16.4.100-200
   - DNS: 1.1.1.1, 8.8.8.8
   - **Status:** ACTIVE - Subnet conflict resolved with production WAN

3. **internal.5** - Studio-LAN
   - IP: 172.16.5.1/24
   - VLAN ID: 5
   - DHCP Pool: 172.16.5.100-200
   - DNS: 1.1.1.1, 8.8.8.8

4. **internal.6** - Guest Network
   - IP: 172.16.6.1/24
   - VLAN ID: 6
   - DHCP Pool: 172.16.6.100-200
   - DNS: 1.1.1.1, 8.8.8.8

### Management Interface
- **dmz:** 192.168.99.1/24
- DHCP Pool: 192.168.99.100-110
- DNS: 1.1.1.1, 8.8.8.8
- Purpose: Management access and testing
- **Status:** DOWN (not currently in use)

### Native/Untagged Network (Default LAN)
- **Interface:** internal (hardware switch)
- **IP:** 192.168.168.168/24
- **DHCP Pool:** 192.168.168.100-200
- **Purpose:** Default LAN - UniFi management network (untagged traffic)
- **Replaces:** SonicWall X0 Default LAN

### Internal Hardware Switch
- **Interface:** internal (ports internal1-5)
- **IP:** 192.168.168.168/24 (native/untagged)
- **Status:** UP
- **Connected Port:** internal5 (trunk to UniFi switch)
- **VLANs Trunked:** 3, 4, 5, 6

## Firewall Policies

### Default FIPS-CC Security Policies (1-6)
Auto-generated by FIPS-CC mode to block bogon traffic:
- Policy 1-6: Block Class-E, Local-Link, non-global IPv6 traffic

### User-Created Policies

**Policy 11:** Management to Internet
- Source: dmz (192.168.99.0/24)
- Destination: wan1.847
- Action: Accept
- NAT: Enabled
- Logging: All traffic

**Policy 12:** Studio-LAN to Internet
- Source: internal.5 (172.16.5.0/24)
- Destination: wan1.847
- Action: Accept
- NAT: Enabled
- Logging: All traffic

**Policy 13:** IoT to Internet
- Source: internal.3 (172.16.3.0/24)
- Destination: wan1.847
- Action: Accept
- NAT: Enabled
- Logging: All traffic (isolated from other VLANs)

**Policy 14:** Guest to Internet
- Source: internal.6 (172.16.6.0/24)
- Destination: wan1.847
- Action: Accept
- NAT: Enabled
- Logging: All traffic (isolated from other VLANs)

**Policy 15:** CORP-LAN to Internet
- Source: internal.4 (172.16.4.0/24)
- Destination: wan1.847
- Action: Accept
- NAT: Enabled
- Logging: All traffic
- Comments: CMMC L2: Corporate network

**Policy 16:** Allow ICMP to ISP Network
- Source: internal.4, internal.3, internal.5, internal.6, dmz
- Destination: ISP-Network-204.186.63.0 (204.186.63.0/26)
- Service: PING
- Action: Accept
- NAT: Enabled
- Comments: Allow ICMP to ISP monitoring network

**Note:** No inter-VLAN traffic is permitted (CMMC segmentation requirement)

## CMMC Level 2 Compliance Settings

### Access Control (NIST 800-171: 3.1.x, 3.5.x)
- **Admin Timeout:** 15 minutes
- **Console Timeout:** 300 seconds (5 minutes)
- **Account Lockout:** 3 failed attempts
- **Lockout Duration:** 300 seconds (5 minutes)
- **Login Banners:** Pre-login and post-login enabled
- **Multi-Factor Authentication:** Optional (can be made required)

### Password Policy (NIST 800-171: 3.5.7)
- **Minimum Length:** 15 characters
- **Complexity Required:**
  - Minimum 1 lowercase letter
  - Minimum 1 uppercase letter
  - Minimum 1 number
  - Minimum 1 special character
- **Password Expiry:** 90 days
- **Password Reuse:** Disabled

### Cryptographic Protection (NIST 800-171: 3.13.11)
- **FIPS-CC Mode:** Enabled (FIPS 140-2 validated cryptography)
- **TLS Minimum Version:** TLS 1.2
- **SSH:** Version 2 only (v1 disabled)
- **Telnet:** Disabled
- **HTTPS Redirect:** Enabled for admin access

### Audit and Accountability (NIST 800-171: 3.3.x)
- **CLI Audit Log:** Enabled
- **SSL Connection Logging:** Enabled
- **Firewall Traffic Logging:** All policies log traffic
- **FortiGate Cloud:** Free tier activated (US region, 7-day log retention)
- **⚠️ TODO:** Upgrade to paid FortiGate Cloud or syslog for 90+ day retention (CMMC requirement)

## Physical Connections

### Production Setup (ACTIVE)
```
[Fiber ISP] ───── wan1 port ───── wan1.847 (VLAN 847: 204.186.251.250/30)
                                   Status: UP, 1000Mbps Full Duplex

[UniFi Switch] ── internal5 port ── internal hard-switch (VLANs 3,4,5,6)
                                     Status: UP, Trunk Mode
```

**Connection Details:**
- WAN: Fiber connected to wan1 physical port
- LAN: UniFi switch trunk cable connected to internal5
- All VLANs operational and routing through wan1.847

## VPN Configuration (In Progress)

### IPsec VPN with Azure AD (Entra ID) SAML SSO
**Status:** BLOCKED - "gw validation failed" during IKE_AUTH (see VPN-SETUP-STATUS.md Troubleshooting)
**Type:** IPsec IKEv2 Dial-Up VPN with EAP
**Authentication:** Azure AD SAML SSO + MFA via Conditional Access
**Client:** FortiClient 7.4.3.1790 (standalone, no EMS)
**Documentation:** See VPN-SETUP-STATUS.md for detailed setup guide

**Previous attempt (IKEv1 XAUTH) failed** — XAUTH cannot do browser-based SAML. IKEv2 + EAP is the correct approach.

**VPN Network:**
- Tunnel Name: CBS-VPN
- IP Pool: 10.255.1.100-200
- Netmask: 255.255.255.0
- DNS: Auto (uses FortiGate DNS: 8.8.8.8, 8.8.4.4)
- Access Model: Full tunnel - Internet only (no internal network access)

**Azure AD Integration:**
- Tenant ID: cd124fca-acb6-43c1-b769-36ee8024d7f9
- Enterprise Application: FortiGate IPsec VPN (SAML)
- SAML Server: AzureAD-VPN
- User Group: VPN-Users-Azure
- VPN Security Group Object ID: c300028f-7819-4225-b334-76695b85aaaa
- Conditional Access: MFA enforced
- SAML Entity ID: https://remote.thecoresolution.com/remote/saml/metadata
- SAML SSO URL: https://remote.thecoresolution.com/remote/saml/login
- IKE SAML Port: 10443 (on wan1.847)

**IPsec Configuration:**
- Phase 1 Interface: CBS-VPN
  - Interface: wan1.847
  - IKE Version: 2
  - Auth Method: Signature + EAP (SAML)
  - Encryption: AES256-SHA256
  - DH Group: 15 (3072-bit MODP)
  - Mode Config: Enabled
- Phase 2 Interface: CBS-VPN
  - Encryption: AES256-SHA256
  - DH Group: 15 with PFS
  - Replay Detection: Enabled

**Firewall Policies:**
- VPN-to-Internet: ALLOW (CBS-VPN -> wan1.847, NAT enabled)
- BLOCK-VPN-to-Internal: DENY (CBS-VPN -> internal/VLANs)
- Policy order: ALLOW must be above DENY

## Deployment Status

### ✅ Completed Items
1. **Production WAN Migration** - December 11, 2025
   - wan1.847 configured and operational
   - Fiber ISP connection active
   - Internet connectivity verified from all VLANs
   - Default route via 204.186.251.249

2. **Internal Network Activation**
   - All 4 VLANs (3, 4, 5, 6) operational
   - DHCP serving addresses on all networks
   - VLAN isolation confirmed (CMMC requirement)
   - UniFi switch trunk connected and working

3. **Firewall Policies**
   - All policies updated to use wan1.847
   - NAT operational on all policies
   - Traffic logging enabled
   - ICMP policy for ISP monitoring added

### Fixes Applied
1. **VLAN 3 (IoT/Guest) DHCP Not Working** - February 2026
   - **Symptom:** Devices on VLAN 3 not receiving DHCP addresses; other VLANs worked fine
   - **Root Cause:** DHCP server 2 (internal.3) had `vci-match enable` with `vci-string "FortiSwitch" "FortiExtender"`, which restricted DHCP to only FortiSwitch/FortiExtender devices
   - **Fix:** `config system dhcp server` > `edit 2` > `set vci-match disable` > `next` > `end`
   - **Diagnosis:** `diagnose debug application dhcps -1` showed "Can't locate subnet in shared network" errors

2. **FortiGuard/DNS Not Working** - February 2026
   - **Symptom:** FortiGuard unavailable, `execute ping update.fortiguard.net` returned "Unable to resolve hostname", all definitions outdated (some from 2015)
   - **Root Cause:** DNS configured for DoT (`set protocol dot`) with `server-hostname "globalsdns.fortinet.net"` but DNS IPs were Google (8.8.8.8/8.8.4.4) — TLS hostname mismatch caused all DNS to fail
   - **Fix:** `config system dns` > `set protocol cleartext` > `end`
   - **Result:** DNS working, FortiGuard connected, definitions updating

3. **NTP Configured** - February 2026
   - Set to FortiGuard NTP servers (`set type fortiguard`)
   - Disabled unnecessary server-mode (was set for FortiLink/FortiSwitch)
   - All 4 NTP servers reachable and syncing

4. **WAN Interface Hardened** - February 2026
   - Removed `https ssh` from wan1.847 allowaccess — only `ping` remains
   - Management access only via CORP-LAN (172.16.4.1)

5. **FortiGate Cloud Activated** - February 2026
   - Free tier, US region
   - 7-day log retention (upgrade needed for CMMC 90+ day requirement)
   - Access via https://www.forticloud.com

### ⚠️ Items to Address

1. **ISP Monitoring** - Waiting on ISP
   - ISP monitoring network (204.186.63.0/26) needs to ping WAN IP (204.186.251.250)
   - **FortiGate side is correctly configured:** `allowaccess ping` enabled on wan1.847
   - **Confirmed via packet capture:** No ICMP packets from 204.186.63.0/26 are reaching the WAN interface
   - **Conclusion:** ISP-side routing issue — their monitoring server farm has no route to 204.186.251.248/30
   - **Status:** Emailed ISP tech to check their routing (February 2026)
   - **Security fix applied:** Removed `https ssh` from wan1.847 allowaccess (February 2026) — management only via CORP-LAN (172.16.4.1)

2. **Management Access**
   - DMZ port available but not currently in use
   - Primary management via CORP-LAN (172.16.4.1)
   - Consider future DMZ use case or repurpose

3. ~~**Firmware Upgrade to 7.4.11**~~
   - **DONE:** Upgraded to 7.4.11 build2878 (Mature) — patches CVE-2026-24858

## Migration from SonicWall

### Original SonicWall Configuration
- **X0:** 192.168.168.168/24 - Default LAN ✅ (Migrated & Active - native/untagged on `internal`)
- **X0:V3:** 172.16.3.1/24 - IoT Guest Network ✅ (Migrated & Active)
- **X0:V4:** 172.16.4.1/24 - CORP-LAN ✅ (Migrated & Active)
- **X0:V5:** 172.16.5.1/24 - Studio-LAN ✅ (Migrated & Active)
- **X0:V6:** 172.16.6.1/24 - Guest Network ✅ (Migrated & Active)
- **X1:V847:** 204.186.251.250/30 - WAN VLAN 847 ✅ (Migrated & Active)
- **X1:V1449:** 204.186.249.142/29 - VLAN 1449 (Not yet migrated)

### Migration Status
- **Date Completed:** December 11, 2025
- **Status:** Production operational
- **SonicWall:** Decommissioned/standby
- **UniFi Switching:** Connected to FortiGate internal5, all VLANs trunked

## Access Information

### GUI Access
- **Production Access:** https://172.16.4.1 (CORP-LAN) - PRIMARY
- **Alternate Access:** https://192.168.99.1 (via DMZ port) - Currently inactive

### Admin Credentials
- **Username:** admin
- **Password:** (15+ character password set during FIPS-CC setup)
- **Note:** Password meets CMMC Level 2 requirements

### Console Access
- **Port:** USB-C console port
- **Settings:** 9600 baud, 8N1
- **Default Login:** admin / (password above)

## Important Notes

### FIPS-CC Mode
⚠️ **CRITICAL:** FIPS-CC mode is **IRREVERSIBLE**. Once enabled, it cannot be disabled without performing a factory reset, which will erase all configuration.

### CMMC Compliance Status
✅ **Ready for C3PAO Assessment** with the following caveats:
- Need to configure centralized logging (syslog/FortiAnalyzer)
- Should create individual admin accounts (no shared admin)
- Consider enabling MFA for admin access
- Document system security plan
- Implement regular configuration backups

## Configuration Backup
**Status:** Production configuration active - backup recommended

**Backup Command:**
```bash
execute backup config management-station "post-migration-backup-20251211"
```

Or via GUI: **System > Configuration > Backup**

**Recommended Schedule:** Weekly backups or after any configuration changes

## Support Resources
- **Fortinet Support:** https://support.fortinet.com
- **Serial Number for Support:** FGT60FTK24031122
- **Documentation:** FortiOS 7.4.9 Administration Guide
- **CMMC Resources:** https://www.acq.osd.mil/cmmc/

## Firewall Address Objects

**ISP-Network-204.186.63.0:**
- Subnet: 204.186.63.0/26 (255.255.255.192)
- Purpose: ISP monitoring network
- Used in: Policy 16 (ICMP to ISP)

---
*Configuration completed: November 2025*
*Production deployment: December 11, 2025*
*Firmware: FortiOS 7.4.11 build2878 (Mature) — upgraded February 2026*
*FIPS-CC Mode: Enabled*
*CMMC Level 2: Compliant (pending centralized logging, individual admin accounts, MFA)*
*Migration Status: COMPLETE - All VLANs operational*
*VPN Status: BLOCKED - "gw validation failed" (see VPN-SETUP-STATUS.md)*
